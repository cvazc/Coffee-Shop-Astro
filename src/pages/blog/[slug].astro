---
import { Picture } from "astro:assets"
import { PostSchema } from "@/types"
import Layout from "@/layouts/Layout.astro"
import PostMeta from "@/components/blog/PostMeta.astro"
import PostCategories from "@/components/blog/PostCategories.astro"

export const prerender = false

const { slug } = Astro.params
const url = `${import.meta.env.API_URL}/posts?slug=${slug}`
const res = await fetch(url)
const json = await res.json()
const post = PostSchema.safeParse(json[0])
if(!post.success) return Astro.redirect('/404')
const { title, featured_images, date, category_details, content } = post.data
---

<Layout
	title={title.rendered}
	subtitle={title.rendered}
	bgImage={featured_images.full.url}
>
	<article class="space-y-5 max-w-4xl mx-auto">
		<PostMeta date={date} />
		{
			category_details.map((category) => (
				<PostCategories name={category.name} />
			))
		}

		<Picture
			src={featured_images.full.url}
			alt={`Imagen del Post: ${title.rendered}`}
			width={featured_images.full.width}
			height={featured_images.full.height}
			formats={["avif", "webp"]}
			class="w-full"
		/>

        <div set:html={content.rendered} class="text-lg space-y-3 mt-5" />
	</article>
</Layout>
